<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Configuring the Library" />
<meta name="DC.relation" scheme="URI" content="GUID-C8A962A9-21E8-4034-9826-BF47F79E568F.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="configuring-the-library" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>Configuring the Library</title>
<meta name="Microsoft.Help.Id" content="GUID-0A4BC4EE-29F5-4736-8125-17139B84E7B5-configuring-the-library" />
<meta name="Microsoft.Help.TocParent" content="GUID-0A4BC4EE-29F5-4736-8125-17139B84E7B5" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony 3 Motor Control Reference A 12/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-C9839457-8BCC-4FA1-859D-4A76D69EEF4D"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="configuring-the-library">
<h1 class="title topictitle1" id="ariaid-title1">Configuring the Library</h1><div class="body"><p class="p">Different UI configurations are explained below.</p>
<p class="p">** Control Algorithm Parameters**
Allows to select application mode like open loop or speed loop or torque loop.</p>
<p class="p">Position feedback determines the feedback loop implementation like PLL estimator sensorless or Encoder based sensored algorithm.</p>
<br /><img class="image" src="GUID-FA81263D-10A8-4E75-92E6-9AABBE7BDDA4-low.jpg" alt="control algorithm" /><br /><p class="p">This allows to configure startup parameters and control loop PI parameters.</p>
<br /><img class="image" src="GUID-3398CA60-038A-4F70-ABE1-586B368DE301-low.jpg" alt="pi parameters" /><br /><p class="p"><strong class="ph b">Flying Start Parameters</strong>
Allows configuration of Flying Start Detection Parameters.</p>
<p class="p">By default, the implementation of this mode is part of an archive file lib_mc_flyingstart.a. In order to access the source file, please contact <a class="xref" href="https://www.microchip.com/salesdirectory" target="_blank">Microchip's Local Sales Office</a>.</p>
<ul class="ul"><li class="li"><p class="p">Flying Start Detect mode uses a separate set of current controller PI gains which can be different than current control PI gains used in normal Run mode. It is recommended that in Flying Start Mode, the current controllers should have higher bandwidth than during normal Run mode.</p>
</li>
<li class="li"><p class="p">Flying Start Detect Duration - Defines the duration in seconds for which the control algorithm will attempt to ascertain if the motor is freewheeling.</p>
</li>
<li class="li"><p class="p">Minimum Flying Start Speed - Defines the minimum speed in RPM below which if the motor is freewheeling, the control algorithm would deem it as "Not Freewheeling"</p>
</li>
<li class="li"><p class="p">Flying Start Current - Defines the starting current in A which would be used during transition from Flying Start Detection -&gt; Closed Loop operation.</p>
</li>
<li class="li"><p class="p">Null Vector Braking Duration - Defines the passive braking duration in seconds, implemented by applying null vector pulses to the motor windings.</p>
</li>
<li class="li"><p class="p">Regenerative Braking - When enabled, if the motor's freewheeling speed is above the minimum flying start detect speed and in the opposite direction to that of command direction, the control algorithm would actively brake the motor using regenerative braking until the motor speed falls below minimum flying start detect speed.</p>
<ul class="ul"><li class="li"><p class="p">Peak Regenerative Braking Current - Defines the maximum regenerative braking current applied in A.</p>
</li>
<li class="li"><p class="p">Regenerative Braking Ramp Duration - Defines the duration in seconds during which the regenerative braking current ramps from 0 to Peak Regenerative Braking Current.</p>
</li>
</ul>
</li>
</ul>
<p class="p"><strong class="ph b">PWM Configurations</strong>
Select the PWM frequency and PWM channels used to drive Phase U, V and W based on board connections. Selected configurations are passed to the PWM PLIB. PWM PLIB is auto-configured for FOC algorithm.</p>
<br /><img class="image" src="GUID-0C3C7D11-6570-495B-919A-29091245E462-low.jpg" alt="pwm" /><br /><p class="p">*Note: Flying start is not supported in SAMC21 and PIC32MK CM MC project.</p>
<p class="p"><strong class="ph b">ADC Configurations</strong></p>
<p class="p">Select ADC channels used for Phase U current, Phase V Current, DC Bus voltage and potentiometer based on the board connections. Selected configurations are passed to the ADC PLIB. ADC PLIB is auto-configured for FOC algorithm.</p>
<br /><img class="image" src="GUID-821BFF21-3758-45A4-BFA9-DFE6662EDA8C-low.jpg" alt="adc" /><br /><p class="p"><strong class="ph b">Encoder Configurations</strong></p>
<p class="p">Select the number of encoder pulses per revolution of the motor. Selected configurations are passed to the QDEC PLIB.</p>
<br /><img class="image" src="GUID-37495922-D39C-4272-80E2-E676AC87A816-low.jpg" alt="encoder" /><br /><p class="p"><strong class="ph b">Motor Parameters</strong></p>
<p class="p">Allows to configure motor parameters. Microchip direct motors are selectable and pre-configured. User can select custom motor to configure parameters for other motors.</p>
<br /><img class="image" src="GUID-4E0BD0F6-6D77-4CFA-B563-04138A30CEB4-low.jpg" alt="motor parameters" /><br /><p class="p"><strong class="ph b">Control Board Parameters</strong></p>
<p class="p">Allows to configure control board parameters. Microchip's motor control development boards like dsPICDEM MCLV-2 development board are selectable and pre-configured. User can select custom board to configure parameters for other boards.</p>
<br /><img class="image" src="GUID-A3499C70-02A8-466C-AE0C-B04CAB9D46E0-low.jpg" alt="control board" /><br /><p class="p"><strong class="ph b">IO Pin Configurations</strong></p>
<p class="p">Configure I/O pins for PWM, ADC, Encoder, UART, input switches and LEDs using the pin manager.</p>
<p class="p"><strong class="ph b">Clock Configurations</strong></p>
<p class="p">CPU clock speed is defaulted to maximum recommended clock frequency of the MCU. View or modify the clock speed using clock manager.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-C8A962A9-21E8-4034-9826-BF47F79E568F.html">Projects without Harmony QSpin</a></div>
</div>
</div></body>
</html>